        amount=payment.amount,
        payment_method=payment.payment_method,
        proof_image_url=payment.proof_image_url
    )
    
    await db.manual_payments.insert_one(manual_payment.model_dump())
    
    # Create notification for admin
    admin_notification = Notification(
        user_id="admin",
        type="manual_payment",
        title="Nuevo Pago Manual",
        message=f"El usuario {current_user['name']} ha subido un comprobante de pago por ${payment.amount:,.0f}",
        data={"payment_id": manual_payment.id, "booking_id": payment.booking_id}
    )
    await db.notifications.insert_one(admin_notification.model_dump())
    
    return {"message": "Comprobante enviado para revisión", "payment_id": manual_payment.id}

@api_router.get("/admin/payments/pending")
async def get_pending_payments(current_user: dict = Depends(get_current_user)):
    """Get all pending manual payments (Admin only)"""
    if current_user.get("role") != "admin":
        raise HTTPException(status_code=403, detail="Acceso denegado")
    
    payments = await db.manual_payments.find({"status": "pending"}).to_list(100)
    for p in payments:
        p.pop("_id", None)
    return payments

@api_router.patch("/admin/payments/{payment_id}/review")
async def review_manual_payment(
    payment_id: str,
    action: str,
    notes: Optional[str] = None,
    current_user: dict = Depends(get_current_user)
):
    """Approve or reject manual payment (Admin only)"""
    if current_user.get("role") != "admin":
        raise HTTPException(status_code=403, detail="Acceso denegado")
    
    if action not in ["approve", "reject"]:
        raise HTTPException(status_code=400, detail="Action debe ser 'approve' o 'reject'")
    
    payment = await db.manual_payments.find_one({"id": payment_id})
    if not payment:
        raise HTTPException(status_code=404, detail="Pago no encontrado")
    
    new_status = "approved" if action == "approve" else "rejected"
        {"id": payment_id},
